{% extends "layout.html" %} {% block head %}
<link rel="stylesheet" href="/static/viewer.css" />
<link rel="stylesheet" href="/static/pdfjs-5.4.54-dist/web/viewer.css" />

<script src="/static/pdfjs-5.4.54-dist/build/pdf.mjs" type="module"></script>
<script src="/static/pdfjs-5.4.54-dist/web/viewer.mjs" type="module"></script>
{% endblock %} {% block content %}
<div class="story-view-wrapper">
  <!-- Sidebar with Story Details -->
  <aside class="story-sidebar" id="storySidebar">
    <div class="sidebar-header">
      <button class="sidebar-toggle" id="sidebarToggle" aria-label="Toggle sidebar">
        <span id="toggleIcon">‚Äπ</span>
      </button>
      <a class="button btn btn-back" href="/">‚Üê Back</a>
    </div>

    <div class="sidebar-content">
      <h2 class="story-title">{{ story.title }}</h2>

      <div class="story-details">
        <div class="detail-item">
          <span class="detail-label">Description</span>
          <p class="detail-value">{{ story.description }}</p>
        </div>

        <div class="detail-item">
          <span class="detail-label">Author</span>
          <span class="detail-value">{{ story.author }}</span>
        </div>

        <!-- <div class="detail-item">
          <span class="detail-label">Type</span>
          <span class="detail-value">üìÑ PDF Story</span>
        </div> -->
      </div>

          <!-- Hints Widget -->
    <div class="hints-widget mt-5" id="hintsWidget">
      <div class="hints-header">
        <h3 class="hints-title">üí° Hints</h3>
        <button
          class="hints-close"
          onclick="document.getElementById('hintsWidget').style.display='none'"
          aria-label="Close hints"
        >
          ‚úï
        </button>
      </div>
      <div class="hints-content">
        <div class="hint-item">
          <img
            src="/static/assets/videos/cursor-click-animation.gif"
            alt="Hint to start story"
            class="hint-image"
          />
          <p class="hint-text">
            Interactive stories are read by clicking links on the page.

            <br />

            Start by clicking the "START" button
          </p>
        </div>
        <!-- <div class="hint-item">
          <img src="https://via.placeholder.com/300x150/7B68EE/ffffff?text=Tip+2" alt="Hint 2" class="hint-image">
          <p class="hint-text">Use the navigation arrows to move between pages quickly.</p>
        </div>
        <div class="hint-item">
          <img src="https://via.placeholder.com/300x150/50C878/ffffff?text=Tip+3" alt="Hint 3" class="hint-image">
          <p class="hint-text">Bookmark your favorite passages by clicking the star icon.</p>
        </div> -->
      </div>
    </div>
    </div>


  </aside>

  <!-- PDF Viewer Section -->
  <main class="pdf-viewer-section" id="pdfViewerSection">
    <div class="viewer-controls">
      <button class="viewer-control-btn" id="fullscreenBtn" aria-label="Toggle fullscreen" title="Fullscreen">
        <span id="fullscreenIcon">‚õ∂</span>
      </button>
    </div>
    <div id="viewerContainer">
      <div id="viewer" class="pdfViewer"></div>
    </div>
  </main>
</div>

<script>
  const _story = {
    id: "{{ story.id }}",
    title: "{{ story.title | safe }}",
    description: "{{ story.description | safe }}",
    author: "{{ story.author | safe }}",
    filename: "{{ story.filename }}",
    pdfUrl: "{{ story.pdf_url }}",
  };

  const DEFAULT_URL = _story.pdfUrl;
</script>

<script src="/static/pdf-viewer.mjs" type="module"></script>

<script>
  // Sidebar toggle functionality
  document.addEventListener('DOMContentLoaded', function() {
    const sidebar = document.getElementById('storySidebar');
    const toggleBtn = document.getElementById('sidebarToggle');
    const toggleIcon = document.getElementById('toggleIcon');

    // Load saved state from localStorage
    const isCollapsed = localStorage.getItem('sidebarCollapsed') === 'true';
    if (isCollapsed) {
      sidebar.classList.add('collapsed');
      toggleIcon.textContent = '‚Ä∫';
    }

    toggleBtn.addEventListener('click', function() {
      sidebar.classList.toggle('collapsed');
      const collapsed = sidebar.classList.contains('collapsed');

      // Update icon
      toggleIcon.textContent = collapsed ? '‚Ä∫' : '‚Äπ';

      // Save state to localStorage
      localStorage.setItem('sidebarCollapsed', collapsed);
    });

    // Fullscreen functionality
    const pdfViewerSection = document.getElementById('pdfViewerSection');
    const fullscreenBtn = document.getElementById('fullscreenBtn');
    const fullscreenIcon = document.getElementById('fullscreenIcon');

    fullscreenBtn.addEventListener('click', function() {
      if (!document.fullscreenElement &&
          !document.webkitFullscreenElement &&
          !document.mozFullScreenElement &&
          !document.msFullscreenElement) {
        // Enter fullscreen
        if (pdfViewerSection.requestFullscreen) {
          pdfViewerSection.requestFullscreen();
        } else if (pdfViewerSection.webkitRequestFullscreen) {
          pdfViewerSection.webkitRequestFullscreen();
        } else if (pdfViewerSection.mozRequestFullScreen) {
          pdfViewerSection.mozRequestFullScreen();
        } else if (pdfViewerSection.msRequestFullscreen) {
          pdfViewerSection.msRequestFullscreen();
        }
      } else {
        // Exit fullscreen
        if (document.exitFullscreen) {
          document.exitFullscreen();
        } else if (document.webkitExitFullscreen) {
          document.webkitExitFullscreen();
        } else if (document.mozCancelFullScreen) {
          document.mozCancelFullScreen();
        } else if (document.msExitFullscreen) {
          document.msExitFullscreen();
        }
      }
    });

    // Update fullscreen icon when fullscreen state changes
    function updateFullscreenIcon() {
      if (document.fullscreenElement ||
          document.webkitFullscreenElement ||
          document.mozFullScreenElement ||
          document.msFullscreenElement) {
        fullscreenIcon.textContent = '‚õ∂';
        fullscreenBtn.setAttribute('title', 'Exit fullscreen');
      } else {
        fullscreenIcon.textContent = '‚õ∂';
        fullscreenBtn.setAttribute('title', 'Fullscreen');
      }
    }

    document.addEventListener('fullscreenchange', updateFullscreenIcon);
    document.addEventListener('webkitfullscreenchange', updateFullscreenIcon);
    document.addEventListener('mozfullscreenchange', updateFullscreenIcon);
    document.addEventListener('MSFullscreenChange', updateFullscreenIcon);
  });
</script>

{% endblock %}
